# Claude Code å·¥å…·æ€§èƒ½åŸºå‡†æµ‹è¯•

## æ¦‚è¿°

`claude-tools-benchmark.js` æ˜¯ä¸€ä¸ªæ€§èƒ½åŸºå‡†æµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹é‡ Claude Code CLI ä¸­å„ä¸ªå·¥å…·çš„æ‰§è¡Œæ€§èƒ½ã€‚è¯¥å·¥å…·æ¨¡æ‹Ÿäº† Claude Code åœ¨å®é™…ä½¿ç”¨ä¸­çš„æ–‡ä»¶æ“ä½œã€æœç´¢å’Œå‘½ä»¤æ‰§è¡Œåœºæ™¯ã€‚

## æµ‹è¯•çš„å·¥å…·

### 1. Read å·¥å…·
- **å°æ–‡ä»¶è¯»å–** (< 1KB): ç›®æ ‡ p95 < 50ms
- **ä¸­ç­‰æ–‡ä»¶è¯»å–** (10-100KB): ç›®æ ‡ p95 < 100ms
- **å¤§æ–‡ä»¶è¯»å–** (> 100KB): ç›®æ ‡ p95 < 150ms

### 2. Write å·¥å…·
- **å°æ–‡ä»¶å†™å…¥** (100 å­—èŠ‚): ç›®æ ‡ p95 < 50ms
- **ä¸­ç­‰æ–‡ä»¶å†™å…¥** (10KB): ç›®æ ‡ p95 < 100ms
- **æ–‡ä»¶è¦†ç›–**: ç›®æ ‡ p95 < 50ms

### 3. Glob å·¥å…·
- **æŸ¥æ‰¾æµ‹è¯•æ–‡ä»¶** (< 100 æ–‡ä»¶): ç›®æ ‡ p95 < 100ms
- **æŸ¥æ‰¾ JS æ–‡ä»¶**: ç›®æ ‡ p95 < 150ms
- **æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶**: ç›®æ ‡ p95 < 200ms

### 4. Grep å·¥å…·
- **å…³é”®å­—æœç´¢**: ç›®æ ‡ p95 < 200ms
- **æ­£åˆ™è¡¨è¾¾å¼æœç´¢**: ç›®æ ‡ p95 < 250ms
- **å¸¦ä¸Šä¸‹æ–‡æœç´¢** (-C é€‰é¡¹): ç›®æ ‡ p95 < 300ms

### 5. Bash å·¥å…·
- **ç®€å•å‘½ä»¤** (echo): ç›®æ ‡ p95 < 100ms
- **æ–‡ä»¶æ“ä½œ** (ls): ç›®æ ‡ p95 < 150ms
- **Git å‘½ä»¤** (git status): ç›®æ ‡ p95 < 300ms

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•ï¼ˆé»˜è®¤ 100 æ¬¡è¿­ä»£ï¼‰
npm run test:tools-benchmark

# æˆ–ç›´æ¥è¿è¡Œ
node tests/claude-tools-benchmark.js
```

### å‘½ä»¤è¡Œé€‰é¡¹

```bash
# è‡ªå®šä¹‰è¿­ä»£æ¬¡æ•°
node tests/claude-tools-benchmark.js --iterations 500

# åªæµ‹è¯•ç‰¹å®šå·¥å…·
node tests/claude-tools-benchmark.js --tool read
node tests/claude-tools-benchmark.js --tool write
node tests/claude-tools-benchmark.js --tool glob
node tests/claude-tools-benchmark.js --tool grep
node tests/claude-tools-benchmark.js --tool bash

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
node tests/claude-tools-benchmark.js --verbose

# ç»„åˆä½¿ç”¨
node tests/claude-tools-benchmark.js --tool read --iterations 200 --verbose

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
node tests/claude-tools-benchmark.js --help
```

## è¾“å‡ºç¤ºä¾‹

```
ğŸš€ Claude Code Tools Performance Benchmark
Iterations: 100 per operation
Target: p95 within specified thresholds

==============================================================================================================
Claude Code Tools Performance Benchmark Results
==============================================================================================================
Operation                   Avg(ms)   Min(ms)   Max(ms)   P50(ms)   P95(ms)   P99(ms)    Target    Status
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Read (small file)              0.35      0.21      1.94      0.29      0.68      1.94       <50    âœ… PASS
Read (medium file)             0.45      0.21      1.59      0.36      1.00      1.59      <100    âœ… PASS
Read (large file)              0.56      0.26      1.62      0.49      1.08      1.62      <150    âœ… PASS
Write (small file)             0.91      0.21      8.21      0.69      2.24      8.21       <50    âœ… PASS
Write (medium file)            0.78      0.24      2.40      0.67      1.87      2.40      <100    âœ… PASS
Write (overwrite)              1.05      0.73      2.66      0.98      1.55      2.66       <50    âœ… PASS
Glob (test files)              6.93      5.10     12.44      6.72      9.63     12.44      <100    âœ… PASS
Glob (js files)               10.93      7.46     82.83      9.74     15.87     82.83      <150    âœ… PASS
Glob (all files)               6.93      5.12     13.28      6.58      9.85     13.28      <200    âœ… PASS
Grep (keyword)                 6.76      4.79     17.17      6.41      9.24     17.17      <200    âœ… PASS
Grep (regex)                   7.05      5.03     43.73      6.40      9.95     43.73      <250    âœ… PASS
Grep (with context)            6.67      4.90     15.65      6.22     11.73     15.65      <300    âœ… PASS
Bash (echo)                    4.73      3.12     10.94      4.45      7.23     10.94      <100    âœ… PASS
Bash (ls)                      7.29      5.41     36.55      6.71      9.35     36.55      <150    âœ… PASS
Bash (git status)             11.18      8.92     18.24     10.73     15.58     18.24      <300    âœ… PASS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… BENCHMARK PASSED: All operations within target thresholds
```

## æ€§èƒ½æŒ‡æ ‡è¯´æ˜

### ç»Ÿè®¡æŒ‡æ ‡

- **Avg (å¹³å‡å€¼)**: æ‰€æœ‰è¿­ä»£çš„å¹³å‡å»¶è¿Ÿ
- **Min (æœ€å°å€¼)**: æœ€å¿«çš„å•æ¬¡æ“ä½œå»¶è¿Ÿ
- **Max (æœ€å¤§å€¼)**: æœ€æ…¢çš„å•æ¬¡æ“ä½œå»¶è¿Ÿ
- **P50 (ä¸­ä½æ•°)**: 50% çš„æ“ä½œåœ¨æ­¤å»¶è¿Ÿä»¥ä¸‹
- **P95 (95 ç™¾åˆ†ä½)**: 95% çš„æ“ä½œåœ¨æ­¤å»¶è¿Ÿä»¥ä¸‹ï¼ˆä¸»è¦æ€§èƒ½ç›®æ ‡ï¼‰
- **P99 (99 ç™¾åˆ†ä½)**: 99% çš„æ“ä½œåœ¨æ­¤å»¶è¿Ÿä»¥ä¸‹

### ä¸ºä»€ä¹ˆå…³æ³¨ P95ï¼Ÿ

P95 å»¶è¿Ÿæ˜¯è¡¡é‡ç³»ç»Ÿæ€§èƒ½çš„å…³é”®æŒ‡æ ‡ï¼Œå› ä¸ºï¼š
1. å®ƒåæ˜ äº†å¤§å¤šæ•°ç”¨æˆ·çš„å®é™…ä½“éªŒï¼ˆ95% çš„è¯·æ±‚ï¼‰
2. å®ƒè€ƒè™‘äº†å¶å‘çš„æ€§èƒ½æ³¢åŠ¨
3. å®ƒæ¯”å¹³å‡å€¼æ›´èƒ½åæ˜ "æœ€åæƒ…å†µä¸‹çš„æ­£å¸¸æ€§èƒ½"

## å®ç°ç»†èŠ‚

### åŸºå‡†æµ‹è¯•æ¡†æ¶

åŸºå‡†æµ‹è¯•ä½¿ç”¨é«˜ç²¾åº¦è®¡æ—¶å™¨ (`process.hrtime.bigint()`) æ¥æµ‹é‡æ¯æ¬¡æ“ä½œçš„å»¶è¿Ÿï¼š

```javascript
async function benchmark(name, iterations, operation) {
    const times = [];

    for (let i = 0; i < iterations; i++) {
        const start = process.hrtime.bigint();
        await operation(i);
        const end = process.hrtime.bigint();
        times.push(Number(end - start) / 1e6); // è½¬æ¢ä¸ºæ¯«ç§’
    }

    // è®¡ç®—ç»Ÿè®¡æ•°æ®
    times.sort((a, b) => a - b);
    const p95 = times[Math.floor(times.length * 0.95)];
    // ...
}
```

### æµ‹è¯•ç¯å¢ƒ

- **æµ‹è¯•ç›®å½•**: `/tmp/claude-tools-benchmark`
- **é¢„çƒ­è¿è¡Œ**: æ¯ä¸ªåŸºå‡†æµ‹è¯•åœ¨æ­£å¼è®¡æ—¶å‰ä¼šæ‰§è¡Œä¸€æ¬¡é¢„çƒ­
- **è‡ªåŠ¨æ¸…ç†**: æµ‹è¯•å®Œæˆåè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶

### å·¥å…·æ¨¡æ‹Ÿ

ç”±äºè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŸºå‡†æµ‹è¯•å·¥å…·ï¼Œå®ƒä½¿ç”¨ Node.js æ ‡å‡†åº“æ¥æ¨¡æ‹Ÿ Claude Code å·¥å…·çš„è¡Œä¸ºï¼š

- **Read**: `fs.promises.readFile()`
- **Write**: `fs.promises.writeFile()`
- **Glob**: `find` å‘½ä»¤ï¼ˆé€šè¿‡ `child_process.exec`ï¼‰
- **Grep**: `grep` å‘½ä»¤ï¼ˆé€šè¿‡ `child_process.exec`ï¼‰
- **Bash**: `child_process.exec()`

## ä¸å…¶ä»–åŸºå‡†æµ‹è¯•çš„å…³ç³»

### Redis åŸºå‡†æµ‹è¯• (`redis-benchmark.js`)

- **ç›®çš„**: æµ‹è¯• Redis æ“ä½œæ€§èƒ½
- **ç›®æ ‡**: p95 < 10ms
- **ç”¨é€”**: éªŒè¯ Redis å­˜å‚¨å±‚æ€§èƒ½

### Kiro æ€§èƒ½æµ‹è¯• (`kiro-performance.test.js`)

- **ç›®çš„**: æµ‹è¯• Kiro provider ä¼˜åŒ–æ•ˆæœ
- **å†…å®¹**: Token ç¼“å­˜ã€å¼‚æ­¥äº’æ–¥é”ã€å­—ç¬¦ä¸²ç¼“å†²åŒº
- **æ¡†æ¶**: Jest å•å…ƒæµ‹è¯•

### å·¥å…·åŸºå‡†æµ‹è¯• (`claude-tools-benchmark.js`)

- **ç›®çš„**: æµ‹è¯• Claude Code å·¥å…·æ€§èƒ½
- **å†…å®¹**: æ–‡ä»¶æ“ä½œã€æœç´¢ã€å‘½ä»¤æ‰§è¡Œ
- **æ¡†æ¶**: ç‹¬ç«‹åŸºå‡†æµ‹è¯•è„šæœ¬

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

å¦‚æœæŸä¸ªå·¥å…·çš„ p95 å»¶è¿Ÿè¶…è¿‡ç›®æ ‡é˜ˆå€¼ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **Read/Write å·¥å…·**
   - ä½¿ç”¨æµå¼è¯»å†™å¤„ç†å¤§æ–‡ä»¶
   - å®ç°æ–‡ä»¶å†…å®¹ç¼“å­˜
   - ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶ (mmap)

2. **Glob å·¥å…·**
   - å®ç°æ–‡ä»¶è·¯å¾„ç´¢å¼•
   - ä½¿ç”¨å¢é‡æ›´æ–°è€Œéå…¨é‡æ‰«æ
   - ç¼“å­˜å¸¸è§çš„ glob æ¨¡å¼ç»“æœ

3. **Grep å·¥å…·**
   - ä½¿ç”¨æ›´å¿«çš„æœç´¢ç®—æ³•ï¼ˆå¦‚ ripgrepï¼‰
   - å®ç°å†…å®¹ç´¢å¼•
   - å¹¶è¡Œæœç´¢å¤šä¸ªæ–‡ä»¶

4. **Bash å·¥å…·**
   - å¤ç”¨è¿›ç¨‹æ± è€Œéæ¯æ¬¡åˆ›å»ºæ–°è¿›ç¨‹
   - å®ç°å‘½ä»¤ç»“æœç¼“å­˜
   - ä½¿ç”¨æ›´è½»é‡çš„ shell (å¦‚ dash)

## é›†æˆåˆ° CI/CD

å¯ä»¥å°†åŸºå‡†æµ‹è¯•é›†æˆåˆ°æŒç»­é›†æˆæµç¨‹ä¸­ï¼š

```yaml
# .github/workflows/benchmark.yml
name: Performance Benchmark

on: [push, pull_request]

jobs:
  benchmark:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'
      - run: npm install
      - run: npm run test:tools-benchmark
```

## æ•…éšœæ’æŸ¥

### åŸºå‡†æµ‹è¯•å¤±è´¥

å¦‚æœåŸºå‡†æµ‹è¯•å¤±è´¥ï¼ˆæŸäº›æ“ä½œè¶…è¿‡é˜ˆå€¼ï¼‰ï¼š

1. **æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½**: ç¡®ä¿ç³»ç»Ÿæ²¡æœ‰å…¶ä»–é«˜è´Ÿè½½è¿›ç¨‹
2. **å¤šæ¬¡è¿è¡Œ**: è¿è¡Œå¤šæ¬¡ä»¥æ’é™¤å¶å‘æ€§èƒ½é—®é¢˜
3. **å¢åŠ è¿­ä»£æ¬¡æ•°**: ä½¿ç”¨ `--iterations 500` è·å¾—æ›´ç¨³å®šçš„ç»“æœ
4. **æ£€æŸ¥ç£ç›˜æ€§èƒ½**: æ–‡ä»¶æ“ä½œæ€§èƒ½ä¾èµ–äºç£ç›˜ I/O

### æµ‹è¯•ç¯å¢ƒé—®é¢˜

å¦‚æœé‡åˆ°æƒé™æˆ–è·¯å¾„é—®é¢˜ï¼š

```bash
# ç¡®ä¿æµ‹è¯•ç›®å½•å¯å†™
mkdir -p /tmp/claude-tools-benchmark
chmod 777 /tmp/claude-tools-benchmark

# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x tests/claude-tools-benchmark.js
```

## æ‰©å±•åŠŸèƒ½

æœªæ¥å¯ä»¥æ·»åŠ çš„åŠŸèƒ½ï¼š

- [ ] å†…å­˜ä½¿ç”¨ç›‘æ§
- [ ] CPU ä½¿ç”¨ç›‘æ§
- [ ] å¯¼å‡º JSON/CSV æ ¼å¼ç»“æœ
- [ ] æ€§èƒ½å›å½’æ£€æµ‹
- [ ] ä¸å†å²æ•°æ®å¯¹æ¯”
- [ ] ç”Ÿæˆæ€§èƒ½è¶‹åŠ¿å›¾è¡¨
- [ ] æ”¯æŒè‡ªå®šä¹‰æ€§èƒ½é˜ˆå€¼

## å‚è€ƒèµ„æ–™

- [Node.js Performance Timing API](https://nodejs.org/api/perf_hooks.html)
- [Redis Benchmark Documentation](../redis/benchmark.md)
- [Claude Code Tools Documentation](../../README.md)

---

**åˆ›å»ºæ—¶é—´**: 2026-01-30
**æœ€åæ›´æ–°**: 2026-01-30
**ç»´æŠ¤è€…**: AIClient-2-API Team
